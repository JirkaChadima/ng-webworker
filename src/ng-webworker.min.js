/**
 * @license ng-webworker v0.1
 * (c) 2014 Matt Slocum
 * License: MIT
 */
!function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(c):b[a]=c()}("ngWebworker",this,function(){"use strict";var a=angular.module("ngWebworker",[]),b="function",c="return",d="complete",e="notice";return a.config(["$provide",function(a){a.value("WebworkerConfig",{workerPath:"worker_wrapper.js",useHelper:!1})}]),a.service("Webworker",["$q","WebworkerConfig",function(a,f){function g(a,b){var c=function(){};b.external||!b.useHelper?this.oWorker=new Worker(a):(this.oWorker=new Worker(f.workerPath),this.strWorkerFunc=a),this.config=angular.extend({onMessage:c,onError:c,onReturn:c,onComplete:c,onNotice:c},b),b.onmessage&&(this.config.onMessage=b.onmessage,this.config.onError=b.onerror)}function complete(a){postMessage({type:"complete",data:a})}function notify(a){postMessage({type:"notice",data:a})}this.create=function(a,d){var e,h,i,j,k=window,l=k.URL||k.webkitURL;if(d=d||{},d=angular.extend({useHelper:f.useHelper},d),(-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0)&&(d.useHelper=!0),Worker&&l&&l.createObjectURL&&(Blob||k.BlobBuilder||k.WebKitBlobBuilder||k.MozBlobBuilder))if(typeof a==b){d.external=!1,d.useHelper||(e=/function\s*(\w+)(.*)/.exec(a.toString()),h=a.toString(),h+="onmessage=function(e){postMessage({type:'"+c+"', data:"+e[1]+".apply(null,e.data)})};",typeof k.Blob===b?i=new Blob([complete,notify,h],{type:"application/javascript"}):(k.BlobBuilder||k.WebKitBlobBuilder||k.MozBlobBuilder||k.MSBlobBuilder)&&(k.BlobBuilder=k.BlobBuilder||k.WebKitBlobBuilder||k.MozBlobBuilder||k.MSBlobBuilder,i=new BlobBuilder,i.append(complete),i.append(notify),i.append(h),i=i.getBlob()));try{j=d.useHelper?new g(a.toString(),d):new g(l.createObjectURL(i),d)}catch(m){}}else d.external=!0,j=new g(a,d);return j},g.prototype.run=function(){var b=a.defer(),f=this;return this.oWorker.onmessage=function(a){var g=a.data.type,h=a.data;f.config.external&&!f.config.async?b.resolve(h):(h=a.data.data,"complete"!=g&&b.notify(h),f.config.onMessage(a),g==c?(f.config.async||b.resolve(h),f.config.onReturn(h)):g==d?(b.resolve(h),f.config.onComplete(h)):g==e&&f.config.onNotice(h))},this.oWorker.onerror=function(a){b.reject(a)},this.oWorker.postMessage(f.config.external||!f.config.useHelper?Array.prototype.slice.call(arguments):{fn:f.strWorkerFunc,args:Array.prototype.slice.call(arguments)}),b.promise},g.prototype.stop=function(){this.oWorker.onerror(new Error("stopped")),this.oWorker.terminate()}}]),a});